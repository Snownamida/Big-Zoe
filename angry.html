<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>愤怒的崔梓璇</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #87CEEB;
            /* Sky blue background */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        canvas {
            display: block;
            touch-action: none;
            /* Prevent default touch behaviors */
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas"></canvas>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Set canvas to full screen for mobile
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Game assets
        const birds = [
            new Image(), new Image(), new Image(), new Image(), new Image(),
            new Image(), new Image(), new Image(), new Image(), new Image()
        ];
        birds[0].src = './images/崔梓璇01.gif';
        birds[1].src = './images/崔梓璇02.gif';
        birds[2].src = './images/崔梓璇03.gif';
        birds[3].src = './images/崔梓璇04.gif';
        birds[4].src = './images/崔梓璇05.gif';
        birds[5].src = './images/崔梓璇06.gif';
        birds[6].src = './images/崔梓璇07.gif';
        birds[7].src = './images/崔梓璇08.gif';
        birds[8].src = './images/崔梓璇09.gif';
        birds[9].src = './images/崔梓璇10.gif';

        const backgroundImg = new Image();
        backgroundImg.src = './images/崔梓璇11.png'; // Use the PNG as background or obstacle

        // Game variables
        let currentBirdIndex = 0;
        let bird = {
            x: 100,
            y: canvas.height - 200,
            vx: 0,
            vy: 0,
            radius: 50,
            launched: false,
            dragging: false
        };
        const slingX = 100;
        const slingY = canvas.height - 200;
        const gravity = 0.5;
        const elasticity = 0.8;

        // Obstacles (simple boxes to destroy)
        let obstacles = [{
            x: canvas.width - 200,
            y: canvas.height - 100,
            width: 100,
            height: 100,
            destroyed: false
        }, {
            x: canvas.width - 250,
            y: canvas.height - 200,
            width: 100,
            height: 100,
            destroyed: false
        }, {
            x: canvas.width - 300,
            y: canvas.height - 300,
            width: 100,
            height: 100,
            destroyed: false
        }];

        // Ground
        const groundY = canvas.height - 50;

        // Touch/mouse events
        let touchStartX = 0,
            touchStartY = 0;
        let touchEndX = 0,
            touchEndY = 0;

        canvas.addEventListener('touchstart', handleTouchStart);
        canvas.addEventListener('touchmove', handleTouchMove);
        canvas.addEventListener('touchend', handleTouchEnd);

        // For desktop testing
        canvas.addEventListener('mousedown', handleTouchStart);
        canvas.addEventListener('mousemove', handleTouchMove);
        canvas.addEventListener('mouseup', handleTouchEnd);

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches ? e.touches[0] : e;
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
            if (!bird.launched && Math.hypot(touchStartX - bird.x, touchStartY - bird.y) < bird.radius) {
                bird.dragging = true;
            }
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (bird.dragging) {
                const touch = e.touches ? e.touches[0] : e;
                bird.x = touch.clientX;
                bird.y = touch.clientY;
            }
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            if (bird.dragging) {
                const touch = e.changedTouches ? e.changedTouches[0] : e;
                touchEndX = touch.clientX;
                touchEndY = touch.clientY;
                launchBird();
                bird.dragging = false;
            }
        }

        function launchBird() {
            const dx = slingX - bird.x;
            const dy = slingY - bird.y;
            bird.vx = dx / 5; // Scale velocity
            bird.vy = dy / 5;
            bird.launched = true;
        }

        function update() {
            if (bird.launched) {
                bird.vy += gravity;
                bird.x += bird.vx;
                bird.y += bird.vy;

                // Collision with ground
                if (bird.y + bird.radius > groundY) {
                    bird.y = groundY - bird.radius;
                    bird.vy = -bird.vy * elasticity;
                    bird.vx *= elasticity;
                    if (Math.abs(bird.vy) < 1) bird.vy = 0;
                    if (Math.abs(bird.vx) < 1) bird.vx = 0;
                }

                // Check collisions with obstacles
                obstacles.forEach(obs => {
                    if (!obs.destroyed && checkCollision(bird, obs)) {
                        obs.destroyed = true;
                        bird.vx *= -elasticity;
                        bird.vy *= -elasticity;
                    }
                });

                // Stop if velocity is low
                if (Math.abs(bird.vx) < 0.1 && Math.abs(bird.vy) < 0.1 && bird.y + bird.radius >= groundY) {
                    resetBird();
                }
            }
        }

        function checkCollision(bird, obs) {
            return bird.x + bird.radius > obs.x && bird.x - bird.radius < obs.x + obs.width &&
                bird.y + bird.radius > obs.y && bird.y - bird.radius < obs.y + obs.height;
        }

        function resetBird() {
            currentBirdIndex = (currentBirdIndex + 1) % birds.length;
            bird = {
                x: slingX,
                y: slingY,
                vx: 0,
                vy: 0,
                radius: 50,
                launched: false,
                dragging: false
            };
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw background
            ctx.drawImage(backgroundImg, 0, 0, canvas.width, canvas.height);

            // Draw ground
            ctx.fillStyle = '#228B22';
            ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

            // Draw sling (simple lines)
            if (!bird.launched) {
                ctx.beginPath();
                ctx.moveTo(slingX - 20, slingY + 50);
                ctx.lineTo(bird.x, bird.y);
                ctx.lineTo(slingX + 20, slingY + 50);
                ctx.strokeStyle = '#8B4513';
                ctx.lineWidth = 5;
                ctx.stroke();
            }

            // Draw bird
            ctx.drawImage(birds[currentBirdIndex], bird.x - bird.radius, bird.y - bird.radius, bird.radius * 2, bird.radius * 2);

            // Draw obstacles
            ctx.fillStyle = '#CD853F';
            obstacles.forEach(obs => {
                if (!obs.destroyed) {
                    ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
                }
            });

            // Check win condition
            if (obstacles.every(obs => obs.destroyed)) {
                ctx.font = '40px Arial';
                ctx.fillStyle = 'white';
                ctx.fillText('胜利！愤怒的崔梓璇摧毁了所有障碍！', canvas.width / 2 - 300, canvas.height / 2);
            }
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Wait for images to load
        let loaded = 0;
        birds.forEach(img => {
            img.onload = () => {
                loaded++;
                if (loaded === birds.length + 1) { // +1 for background
                    gameLoop();
                }
            };
        });
        backgroundImg.onload = () => {
            loaded++;
            if (loaded === birds.length + 1) {
                gameLoop();
            }
        };
    </script>
</body>

</html>